<html>
  <header>
    <title>10 Fastinger</title>
    <meta charset="utf-8"></meta>
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://unpkg.com/vue-router"></script>
  </header>
  <body>
    <!-- <div id="app">
      <router-view></router-view>
      <navbar></navbar>
      <div class="tile is-ancestor container-ancestor">
        <div class="tile is-8 is-parent">
          <div class="logic-form"> -->
            <!-- typingpanel -->
            <!-- <typing-panel :time-counter-max="60" @on-finish="onFinishTyping"></typing-panel> -->
            <!-- end typingpanel -->

            <!-- result -->
            <!-- <result-panel v-if="isShowResult" :result-data="resultData"></result-panel> -->
            <!-- end result -->
          <!-- </div>
        </div> -->
       
        <!-- <div class="tile is-4 is-vertical is-parent rank-fix"> -->
          <!-- ranking -->
          <!-- <ranking-panel></ranking-panel> -->
          <!-- end ranking -->
          <!-- user progress -->
          <!-- <user-progress :progress="userProgress"></user-progress> -->
          <!-- end user progress -->
        <!-- </div>
      </div>
    </div> -->

    <!-- container -->
    <div id="app">
      <div class="container">
        <div class="container-left">
          <div class="logo"> 
            <img src="img/logo.png" alt="">
          </div>
          <!-- ranking -->
          <ranking-panel></ranking-panel>
          <!-- end ranking -->
        </div>
        <div class="container-right">
          <navbar></navbar>
          <div class="main">
            <!-- typingpanel -->
            <typing-panel :time-counter-max="60" @on-finish="onFinishTyping"></typing-panel>
            <!-- end typingpanel -->
            <div class="footer">
              <!-- <div class="result">
                <div class="text-result">Result</div>
                <div class="wpm"><span id="wpm">55</span> WPM</div>
                <div class="value-rls">
                  <div class="value-left">
                    Keystrokes:
                  </div>
                  <div class="value-right">
                    <span id="accuracy"><span>22</span> (<span style="color: green;">22</span> | <span style="color: red;">44</span>)</span>
                  </div>
                </div>
                <div class="value-rls">
                  <div class="value-left">
                    Accuracy:
                  </div>
                  <div class="value-right">
                    <span id="accuracy">33.33</span>%
                  </div>
                </div>
                <div class="value-rls">
                  <div class="value-left">
                    Correct Words:
                  </div>
                  <div class="value-right">
                    <span id="correctWords">32</span>
                  </div>
                </div>
                <div class="value-rls">
                  <div class="value-left">
                    Wrong Words:
                  </div>
                  <div class="value-right">
                    <span id="wrongWords">43</span>
                  </div>
                </div>
                <button class="button is-primary btn-icon-fb">
                  <span class="icon">
                    <i class="fab fa-facebook-f"></i>
                  </span>
                  <span>Facebook</span>
                </button>
              </div> -->
              <!-- result -->
              <result-panel v-if="isShowResult" :result-data="resultData"></result-panel>
              <!-- end result -->
              <div class="qc"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- end container -->
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/7.8.2/firebase-app.js"></script>
  <!-- TODO: Add SDKs for Firebase products that you want to use
       https://firebase.google.com/docs/web/setup#available-libraries -->
  <script src="https://www.gstatic.com/firebasejs/7.8.2/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.8.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.8.2/firebase-database.js"></script>
  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyC1sdeokehKf3rVnW6fsdjbx3jU2qpOWEQ",
      authDomain: "typing-faster.firebaseapp.com",
      databaseURL: "https://typing-faster.firebaseio.com",
      projectId: "typing-faster",
      storageBucket: "typing-faster.appspot.com",
      messagingSenderId: "196680192033",
      appId: "1:196680192033:web:20392bcefaa4e242f31360",
      measurementId: "G-RP9768H8VM"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
    // Get a reference to the database service
    var database = firebase.database();
    console.log("database: ", database);

  </script>

  <script>
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '188272749119547',
        cookie     : true,
        xfbml      : true,
        version    : '1.0'
      });
        
      FB.AppEvents.logPageView();   
        
    };

    (function(d, s, id){
       var js, fjs = d.getElementsByTagName(s)[0];
       if (d.getElementById(id)) {return;}
       js = d.createElement(s); js.id = id;
       js.src = "https://connect.facebook.net/en_US/sdk.js";
       fjs.parentNode.insertBefore(js, fjs);
     }(document, 'script', 'facebook-jssdk'));
  </script>
  <script src="js/navbar.js"></script>
  <script src="js/result.js"></script>
  <script src="js/ranking.js"></script>
  <script src="js/script.js"></script>
  <script src="js/form.js"></script>
  <script src="js/user_progress.js"></script>
  <script>
    var routes = [
      { path: '/tiengviet', component: navbarComponent }
    ];
    var router = new VueRouter({
      routes: routes,
      mode: 'history'
    });
    var app = new Vue({
      el: '#app',
        router: router,
      data() {
        return {
          fast_counter: 60,
          slow_counter: 600,
          resultData: {
            wpm: 100,
            keystrokes: 23,
            accuracy: 22.33,
            wrongWords: 23,
            corectWords: 22,
            keystrokesWrong: 32,
            countKeystrokes: 22
          },
          isShowResult: false,
          userProgress: {}
        }
      },
      methods: {
        onFinishTyping(e){
          this.resultData = {
            wpm: Math.ceil(e.keystrokes),
            keystrokesCorrect: e.keystrokesCorrect,
            accuracy: e.accuracy.toFixed(2),
            wrongWords: e.wrongWords,
            corectWords: e.corectWords,
            keystrokesWrong: e.keystrokesWrong,
            countKeystrokes: e.countKeystrokes
          }
          this.isShowResult = true

          // Submit score
          var user = firebase.auth().currentUser;
          if (user != null) {
            this.submitUserProgress(user.uid, this.resultData);
          }
        },
        submitUserProgress(userId, resultData) {
          // Gui data len server theo duong dan ben duoi
          var timeStamp = new Date().getTime();
          var refId = '/users/' + userId + '/progress/' + timeStamp;
          firebase.database().ref(refId).set(resultData);
        }
      },
      components: {
        'navbar': navbarComponent,
        'typing-panel': typingPanel,
        'result-panel': resultPanel,
        'ranking-panel': rankingPanel,
        'user-progress': userProgress
      },
      mounted() {
        var vm = this;
        //xu ly login fb
        firebase.auth().onAuthStateChanged(function(user) {
          if (user != null) {
            // Fetch user progress data
            var userId = firebase.auth().currentUser.uid;
            firebase.database().ref('/users/' + userId + "/progress/").on('value', function(snapshot) {
              vm.userProgress = snapshot.val();
            });
          }
          console.log("user", user);
        });
      }
    })
  </script>
  </body>
</html>